# Mora 前端配置说明

## 🎉 前端代码已完善

已添加所有缺失的功能模块和依赖，项目现在可以正常运行。

---

## 📦 已安装的依赖

```bash
npm install @monaco-editor/react pyodide react-router-dom
```

**新增依赖说明**：
- `@monaco-editor/react`: 代码编辑器组件，支持Python语法高亮
- `pyodide`: 浏览器内Python运行环境
- `react-router-dom`: React路由管理

---

## 📁 新增文件结构

```
src/
├── types/
│   └── session.ts              # 会话类型定义
├── hooks/
│   ├── usePyodide.ts          # Python执行引擎Hook
│   ├── useSSE.ts              # SSE流式接收Hook
│   └── useVideoSync.ts        # 视频代码同步Hook
├── services/
│   └── api.ts                 # API服务封装
├── pages/
│   ├── Home.tsx               # 首页页面组件
│   └── Workspace.tsx          # 工作区页面组件
├── components/
│   ├── CodeEditor.tsx         # Monaco编辑器组件
│   └── WorkspacePage.tsx      # 工作区内容组件
└── vite-env.d.ts              # Vite环境变量类型
```

---

## ⚙️ 环境变量配置

已创建 `.env` 文件：

```bash
VITE_API_URL=http://localhost:8000
```

**说明**：
- 这是后端API的地址
- 开发环境默认使用 `http://localhost:8000`
- 生产环境需要修改为实际的后端地址

**⚠️ 重要**：API密钥（BibiGPT和DeepSeek）应该配置在**后端**，前端不应该暴露密钥！

---

## 🚀 启动项目

### 1. 启动开发服务器

```bash
cd "Video Conversion App Design"
npm run dev
```

访问：http://localhost:5173

### 2. 构建生产版本

```bash
npm run build
```

构建产物在 `dist/` 目录

---

## 🔑 核心功能实现

### 1. 视频转代码工作流

**用户操作流程**：
1. 在首页输入视频URL（YouTube/Bilibili/TikTok）
2. 点击 "Video to Code" 按钮
3. 系统创建会话并跳转到工作区
4. 通过SSE接收实时处理进度
5. 查看生成的代码和执行结果

### 2. 实时处理进度（SSE）

通过 `useSSE` Hook接收后端推送的事件：
- `thought`: AI思考过程
- `subtitle`: 字幕提取完成
- `code`: 代码片段（流式）
- `timeline`: 时间轴映射
- `done`: 处理完成

### 3. 视频代码同步

通过 `useVideoSync` Hook实现：
- 监听视频播放进度
- 根据时间轴自动高亮对应代码行
- Monaco Editor显示高亮效果

### 4. Python代码执行

通过 `usePyodide` Hook实现：
- 浏览器内运行Python代码
- 无需服务器支持
- 显示执行结果和错误信息

---

## 🎨 UI组件说明

### WorkspacePage（工作区）

**布局**：
- **左侧**（可调整大小）：
  - 视频播放器
  - AI思考过程显示
- **右侧**：
  - 代码编辑器（Monaco Editor）
  - 执行结果面板

**功能按钮**：
- **Copy**: 复制生成的代码
- **Run**: 在Pyodide中执行代码
- **Export**: 导出代码（待实现）

---

## 🔧 技术细节

### Monaco Editor配置

```typescript
<Editor
  height="100%"
  language="python"
  theme="vs-dark"
  options={{
    minimap: { enabled: false },
    fontSize: 14,
    lineNumbers: 'on',
    scrollBeyondLastLine: false,
    automaticLayout: true,
    tabSize: 4,
    wordWrap: 'on',
  }}
/>
```

### Pyodide加载

- 从CDN加载：`https://cdn.jsdelivr.net/pyodide/v0.25.0/full/`
- 预加载常用包：`numpy`, `pandas`
- 首次加载需要3-5秒

### SSE连接

```typescript
const eventSource = new EventSource(
  `${API_URL}/api/session/${sessionId}/stream`
);
```

---

## 📊 路由结构

| 路径 | 组件 | 说明 |
|------|------|------|
| `/` | Home | 首页，视频URL输入 |
| `/workspace?session=xxx` | Workspace | 工作区，代码生成和执行 |

---

## 🐛 已知问题和解决方案

### 1. TypeScript类型错误

**现象**：IDE显示React相关类型错误

**原因**：依赖刚安装，类型定义未加载

**解决**：
- 重启IDE或TypeScript服务器
- 运行 `npm run dev` 后错误会自动消失

### 2. Pyodide加载慢

**现象**：首次加载需要等待

**解决方案**：
- 显示加载状态（已实现）
- 考虑自托管Pyodide文件
- 使用Service Worker缓存

### 3. SSE连接中断

**现象**：长时间处理时连接断开

**解决方案**：
- 后端Nginx配置添加 `X-Accel-Buffering: no`
- 前端实现断线重连（待实现）
- 通过GET接口恢复状态

---

## 📝 下一步开发建议

### 前端优化

1. **错误处理增强**
   - 添加全局错误边界
   - 优化错误提示UI
   - 实现断线重连

2. **用户体验优化**
   - 添加加载骨架屏
   - 优化Pyodide加载体验
   - 添加代码执行历史

3. **功能增强**
   - 实现Export功能
   - 支持多种编程语言
   - 添加代码分享功能

### 后端集成

**前端已就绪，现在需要启动后端服务**：

1. 创建后端项目（参考 `docs/后端实现规范.md`）
2. 配置API密钥：
   - BibiGPT Token: `pyUCIr0m4FLU`
   - DeepSeek API Key: `sk-ce51524faa084f4c92bbbf32cca843cb`
3. 启动后端服务：`uvicorn app.main:app --reload`
4. 确保前端 `.env` 中的 `VITE_API_URL` 正确

---

## 🧪 测试建议

### 手动测试流程

1. **视频URL提交测试**
   ```
   - 输入YouTube URL
   - 点击 Video to Code
   - 检查是否跳转到工作区
   ```

2. **SSE连接测试**
   ```
   - 观察AI思考过程是否实时显示
   - 检查代码是否流式生成
   - 确认处理完成后状态更新
   ```

3. **代码执行测试**
   ```
   - 等待代码生成完成
   - 点击Run按钮
   - 检查执行结果是否正确显示
   ```

4. **视频同步测试**
   ```
   - 播放视频
   - 观察代码是否自动高亮
   - 检查高亮行号是否正确
   ```

---

## 📚 参考文档

详细实现说明请参考：
- `docs/前端实现规范.md` - 完整前端实现细节
- `docs/后端实现规范.md` - 后端项目结构
- `docs/API路由实现.md` - API接口定义
- `docs/部署方案.md` - 部署和环境配置

---

## ✅ 完成清单

- [x] 安装依赖（Monaco Editor, Pyodide, React Router）
- [x] 创建TypeScript类型系统
- [x] 实现API服务封装
- [x] 实现核心Hooks（Pyodide, SSE, VideoSync）
- [x] 创建Monaco Editor组件
- [x] 配置React Router
- [x] 集成视频提交逻辑
- [x] 创建WorkspacePage组件
- [x] 添加CSS样式
- [x] 配置环境变量

**前端代码已完善，可以开始后端开发！**
